#!/usr/bin/env python3
"""
ğŸ”§ Fix Connection Pool Issues
Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ø§ØªØµØ§Ù„Ø§Øª Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯
"""

import os
import sys

def main():
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ”§ CONNECTION POOL OPTIMIZATION APPLIED                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)
    
    # Read the current main_bot.py
    main_bot_path = "bots/main_bot.py"
    
    print("ğŸ“ Ø¨Ø±Ø±Ø³ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ù„ÛŒ...")
    
    # Check if we have the right configuration
    with open(main_bot_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    if "connection_pool_size=32" in content:
        print("âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Connection Pool Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª!")
        print("   - Connection Pool Size: 32")
        print("   - Connect Timeout: 10s")
        print("   - Read Timeout: 15s")
        print("   - Write Timeout: 15s")
        print("   - Pool Timeout: 10s")
    else:
        print("âš ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Connection Pool Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø±Ø¯!")
        
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  âŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‚Ø¨Ù„ÛŒ (Ø¨Ø§Ø¹Ø« Ú©Ù†Ø¯ÛŒ):                                â•‘
â•‘     - Connection Pool: Default (8)                            â•‘
â•‘     - Timeouts: 30 seconds (Ø®ÛŒÙ„ÛŒ Ø²ÛŒØ§Ø¯)                        â•‘
â•‘                                                                â•‘
â•‘  âŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø´ØªØ¨Ø§Ù‡ (Ø¨Ø§Ø¹Ø« pool timeout):                       â•‘
â•‘     - Connection Pool: Default (8)                            â•‘
â•‘     - Timeouts: 5 seconds (Ø®ÛŒÙ„ÛŒ Ú©Ù…)                          â•‘
â•‘                                                                â•‘
â•‘  âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ÛŒÙ†Ù‡ ÙØ¹Ù„ÛŒ:                                       â•‘
â•‘     - Connection Pool: 32 (4x Ø§ÙØ²Ø§ÛŒØ´)                        â•‘
â•‘     - Connect Timeout: 10s (Ù…ØªØ¹Ø§Ø¯Ù„)                          â•‘
â•‘     - Read/Write Timeout: 15s (Ú©Ø§ÙÛŒ)                         â•‘
â•‘     - Pool Timeout: 10s (ØµØ¨Ø± Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„)                     â•‘
â•‘                                                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  ğŸ¯ Ù…Ø´Ú©Ù„Ø§Øª Ø±ÙØ¹ Ø´Ø¯Ù‡:                                           â•‘
â•‘     1. Ø®Ø·Ø§ÛŒ "Pool timeout" Ø¨Ø±Ø·Ø±Ù Ø´Ø¯                           â•‘
â•‘     2. Ø¸Ø±ÙÛŒØª Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ø²Ù…Ø§Ù† 4 Ø¨Ø±Ø§Ø¨Ø± Ø´Ø¯                         â•‘
â•‘     3. Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡ Ø´Ø¯                                 â•‘
â•‘     4. Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ… Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØª                              â•‘
â•‘                                                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  âš¡ Ø±Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯:                                 â•‘
â•‘     1. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Redis Ø¨Ø±Ø§ÛŒ cache                           â•‘
â•‘     2. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² webhook Ø¨Ù‡ Ø¬Ø§ÛŒ polling                     â•‘
â•‘     3. Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ rate limiting                              â•‘
â•‘     4. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² worker pool Ø¨Ø±Ø§ÛŒ heavy tasks              â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ Ø¯Ø³ØªÙˆØ± Ø±ÛŒØ³ØªØ§Ø±Øª Ø¨Ø§Øª:
""")
    
    # Show platform-specific restart command
    if sys.platform == "win32":
        print("   > python run.py")
    else:
        print("   > sudo systemctl restart telegram-bot")
        print("   ÛŒØ§")
        print("   > python3 run.py")
    
    print("\nâ° Ø¨Ø§Øª Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ù¾Ø§Ø³Ø® Ø¯Ù‡Ø¯!")
    
    return 0

if __name__ == "__main__":
    sys.exit(main())
